<include file="Public:header_new"/>
<style type="text/css">
.selpic{line-height:20px;float:left;}
.progress{background:rgb(0,183,238);opacity:0.5;filter:Alpha(opacity=50);margin-bottom:5px;height:5px;line-height:5px;border-radius:2px;}
</style>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/js/webuploader.css">
<script type="text/javascript" src="__PUBLIC__/Home/js/webuploader.js"></script>
<div class="usernewout">
	<include file="User:top"/>
	<div class="usncont">
	  <!--左侧菜单-->
	  <include file="User:left" />
	  <div class="usnc_right">
		<h1>实名认证</h1>
		<switch name="shiming">
			<case value="3">
			<div class="pwtrade">
			  <form id="form-nameauth">
			   <!-- <div class="band_succ">
				<em></em>已通过实名认证
			   </div> -->
			   <p style="color:rgba(0,0,0,0.7);background: #ecf6fd;vertical-align: middle;line-height:37px;text-indent: 10px;margin-bottom:20px;text-align: left;"><img src="__PUBLIC__/Home/news/images/tx.png" alt="" style="vertical-align: middle;margin-right: 5px;">
已通过实名认证</p>
			   <div class="set_verify">
				<ul>
				 <li>您的身份信息</li>
				 <li>证件姓名：{$user.truename}</li>
				 <li>证件类型：{$user.zhengjian}</li>
				 <li>证件号码：{$user.idcard}</li>
				 <li>认证时间：{$user['addtime']|addtime}</li>
				</ul>
			   </div>
			  </form>
			</div>
			</case>
			<case value="2">
			<div class="pwtrade">
			  <form id="form-nameauth">
			 <!--   <div class="band_succ">
				<em></em>您提交的信息正在等待管理员审核
			   </div> -->
			   		<p style="color:rgba(0,0,0,0.7);background: #ecf6fd;vertical-align: middle;line-height:37px;text-indent: 10px;margin-bottom:20px;"><img src="__PUBLIC__/Home/news/images/tx.png" alt="" style="vertical-align: middle;margin-right: 5px;">
您提交的信息正在等待管理员审核</p>
			   <div class="set_verify">
				<ul>
				 <li>您的身份信息</li>
				 <li>证件姓名：{$user.truename}</li>
				 <li>证件类型：{$user.zhengjian}</li>
				 <li>证件号码：{$user.idcard}</li>
				 <li>认证时间：{$user['addtime']|addtime}</li>
				</ul>
			   </div>
			   
			  </form>
			</div>
			</case>
			
			<case value="1">
				<form action="{:U('User/upauth2')}" name="idcard" method="post" enctype="multipart/form-data" style="background: #fff;padding:20px 30px;min-height: 700px;height: auto;" id="form1" name="form1">
					<if condition="$user.is_agree eq '2'">

					<p style="color:rgba(0,0,0,0.7);background: #ecf6fd;vertical-align: middle;line-height:37px;text-indent: 10px;margin-bottom:20px;"><img src="__PUBLIC__/Home/news/images/tx.png" alt="" style="vertical-align: middle;margin-right: 5px;">
					您提交的信息被管理员驳回，请重新修改资料   <font color="red">拒绝原因：{$user['freason']}</font>
					</p>
					</if>
					<div class="set_verify" style="padding:0!important;text-align: center;">
					<p style="color:rgba(0,0,0,0.7);background: #ecf6fd;vertical-align: middle;text-align:left;line-height:37px;text-indent: 10px;margin-bottom:20px;"><img src="__PUBLIC__/Home/news/images/tx.png" alt="" style="vertical-align: middle;margin-right: 5px;">
上传的证件不会作为验证身份的材料，仅用于处理纠纷及账户核对，图片体积要小于2M</p>
						<ul style="display: inline-block;">
							<li><label style="width:140px;float:left;height:40px;text-align: right;">证件姓名：</label>
							<input type="text" name="truename" id="truename" class="rechipt" value="{$user['truename']}" style="width:300px;border:1px solid #d9d9d9;height: 30px;line-height: 30px;border-radius: 4px;" /></li>
							<li><label style="width:140px;float:left;height:40px;text-align: right;">证件类型：</label>
								<select name="zhengjian" id="zhengjian" class="paysel" style="width:302px;border:1px solid #d9d9d9;line-height: 32px;height: 32px;border-radius: 4px;">
									<volist name="idcardtype" id="vo">
										<eq name="user.zhengjian" value="$vo[1]">
											<option value="{$vo[0]}" selected="selected">{$vo[1]}</option>
											<else/>
											<option value="{$vo[0]}" >{$vo[1]}</option>
										</eq>
									</volist>
								</select>
							</li>
							<li><label style="width:140px;float:left;height:40px;text-align: right;">证件号码：</label><input type="text" name="idcard" id="idcard" class="rechipt" value="{$user['idcard']}" style="width:300px;border:1px solid #d9d9d9;height: 30px;line-height: 30px;border-radius: 4px;"/></li>
							<li style="height:190px;">
								<label style="width:140px;float:left;height:40px;text-align: right;">上传证件正面照片：</label>
								<div class="selpic">
									<!--用来存放item-->
									<div id="fileList" class="uploader-list"></div>
									<div id="filePicker">选择图片</div>
									<input type="hidden" name="idcard_zheng" id="WU_FILE_0_1" />
								</div>
							</li>
							<li style="height:190px;">
								<label style="width:140px;float:left;height:40px;text-align: right;">上传证件反面照片：</label>
								<div class="selpic">
									<div id="fileList1" class="uploader-list"></div>
									<div id="filePicker1">选择图片</div>
									<input type="hidden" name="idcard_fan" id="WU_FILE_1_1" />
								</div>
							</li>
							<li style="height:190px;">
								<label style="width:140px;float:left;height:40px;text-align: right;">上传证件手持照片：</label>
								<div class="selpic">
									<div id="fileList2" class="uploader-list"></div>
									<div id="filePicker2">选择图片</div>
									<input type="hidden" name="idcard_shouchi" id="WU_FILE_2_1" />
								</div>
							</li>
						</ul>
				    </div>
					<div class="dv_submit" style="margin-bottom:30px;margin-top:20px;margin-left:238px;">
						<input type="button" value="提交身份认证信息" onclick="idrz();" id="subbb" />
						<div id="submittips"></div>
					</div>
				</form>
				
				<script type="text/javascript">
				function idrz(){
					layer.tips('提交中，页面自动刷新前请勿操作。。。', '#subbb', {
						tips: 3,time:20000
					});
					var idcard_zheng = $("#WU_FILE_0_1").val();
					var idcard_fan = $("#WU_FILE_1_1").val();
					var idcard_shouchi = $("#WU_FILE_2_1").val();
					if(idcard_zheng == "" || idcard_zheng == null){
						layer.tips('请上传证件照片正面', '#filePicker', {
							tips: 3
						});
						return false;
					}
					if(idcard_fan == "" || idcard_fan == null){
						layer.tips('请上传证件照片反面', '#filePicker1', {
							tips: 3
						});
						return false;
					}
					if(idcard_shouchi == "" || idcard_shouchi == null){
						layer.tips('请上传手持证件拍摄的照片', '#filePicker2', {
							tips: 3
						});
						return false;
					}
					var zhengjian = $("#zhengjian").val();
					var truename = $("#truename").val();
					var idcard = $("#idcard").val();
					if(truename == "" || truename == null){
						layer.tips('请填写真实姓名', '#truename', {
							tips: 3
						});
						return false;
					}
					if(idcard == "" || idcard == null){
						layer.tips('请填身份证号码', '#idcard', {
							tips: 3
						});
						return false;
					}
					layer.load(0, {shade: [0.5,'#8F8F8F']});

        			$.ajax({
				       url: "{:U('User/upauth2')}" ,
				       type: 'POST',
				       data: {'idcard':idcard,'zhengjian':zhengjian,'truename':truename,'idcard_zheng':idcard_zheng,'idcard_fan':idcard_fan,'idcard_shouchi':idcard_shouchi},
				       dataType:'json',
				       success: function (data) {
							layer.closeAll();
				            if (data.status == 1) {
								layer.msg(data.info, {icon: 16});
								setTimeout('window.location = "{:U('User/nameauth')}";',1000);
							} else {
								layer.msg(data.info);
								if (data.url) {
									window.location = data.url;
								}
							}
				       }
					});
				}

				// 图片上传demo
				function idcard(sel,pic){
					var $ = jQuery,
						$list = $('#'+sel),
						// 优化retina, 在retina下这个值是2
						ratio = window.devicePixelRatio || 1,

						// 缩略图大小
						thumbnailWidth = 120 * ratio,
						thumbnailHeight = 90 * ratio,

						// Web Uploader实例
						uploader;

					// 初始化Web Uploader
					uploader = WebUploader.create({

						// 自动上传。
						auto: true,

						// swf文件路径
						swf: '/Public/Home/js/Uploader.swf',

						// 文件接收服务端。
						server: '/User/idcard',

						// 选择文件的按钮。可选。
						// 内部根据当前运行是创建，可能是input元素，也可能是flash.
						pick: '#'+pic,

						// 只允许选择文件，可选。
						accept: {
							title: 'Images',
							extensions: 'gif,jpg,jpeg,bmp,png',
							mimeTypes: 'image/*'
						}
					});

					// 当有文件添加进来的时候
					uploader.on( 'fileQueued', function( file ) {
						var $li = $(
								'<div id="' + file.id + '" class="file-item thumbnail">' +
									'<img>' +
								'</div>'
								),
							$img = $li.find('img');

						$list.html( $li );

						// 创建缩略图
						uploader.makeThumb( file, function( error, src ) {
							if ( error ) {
								$img.replaceWith('<span>不能预览</span>');
								return;
							}

							$img.attr( 'src', src );
						}, thumbnailWidth, thumbnailHeight );
					});

					// 文件上传过程中创建进度条实时显示。
					uploader.on( 'uploadProgress', function( file, percentage ) {
						var $li = $( '#'+file.id ),
							$percent = $li.find('.progress span');

						// 避免重复创建
						if ( !$percent.length ) {
							$percent = $('<p class="progress"><span></span></p>')
									.appendTo( $li )
									.find('span');
						}

						$percent.css( 'width', percentage * 100 + '%' );
					});

					// 文件上传成功，给item添加成功class, 用样式标记上传成功。
					uploader.on( 'uploadSuccess', function( file,response ) {
						$('#'+file.id+'_1').val(response.name);
						$( '#'+file.id ).addClass('upload-state-done');
					});

					// 文件上传失败，现实上传出错。
					uploader.on( 'uploadError', function( file ) {
						var $li = $( '#'+file.id ),
							$error = $li.find('div.error');

						// 避免重复创建
						if ( !$error.length ) {
							$error = $('<div class="error"></div>').appendTo( $li );
						}

						$error.text('上传失败');
					});

					// 完成上传完了，成功或者失败，先删除进度条。
					uploader.on( 'uploadComplete', function( file ) {
						$( '#'+file.id ).find('.progress').remove();
					});
				}
				window.onload=function(){
					idcard("fileList","filePicker");
					idcard("fileList1","filePicker1");
					idcard("fileList2","filePicker2");
				}
				</script>
			</case>
			<default />
		</switch>
	  </div>
	</div>
</div>
<script type="text/javascript">
//顶部菜单高亮
$('#user_box').addClass('on');
$('#user_nameauth').addClass('on');
$('#user_nameauth i').attr('class','coin_menu_op_8');
$("#finance_mycz").addClass('on');
</script>
</body>
</html>
<include file="Public:header_new"/>
<div class="usernewout">
<include file="User:top"/>
<div class="usncont">
  <!--左侧菜单-->
  <include file="User:left"/>
  <!--右侧内容-->
  <div class="usnc_right">
      <if condition="$user['mibao_question'] eq '' || $user['mibao_question'] eq null">
		<h1>设置密保问题</h1>
	  <else />
	    <h1>修改密保问题</h1>
	  </if>
      <div class="rech_top">
          <div class="rech_box">
              <div class="rech_bd safe_rech_bd">
                  <ul>
                      <li>
					  <if condition="$user['mibao_question'] eq '' || $user['mibao_question'] eq null">
                          <div class="rechmid">
                              <div class="rechipt_box">
                                  <label><span style="color:#fd634f;margin-right: 4px;">*</span>密保问题：</label>
                                  <div class="iptbox">
                                      <select id="new_mibao_question" class="rechipt" style="width:400px;">
                                    <option value="">请选择密保问题</option>
                                    <option value="你父亲的姓名">你父亲的姓名</option>
                                    <option value="你母亲的姓名">你母亲的姓名</option>
                                    <option value="你爱人的姓名">你爱人的姓名</option>
                                    <option value="你的出生日期">你的出生日期</option>
                                    <option value="你父亲的出生日期">你父亲的出生日期</option>
                                    <option value="你母亲的出生日期">你母亲的出生日期</option>
                                    <option value="你爱人的出生日期">你爱人的出生日期</option>
                                </select>
                                  </div>
                              </div>

                              <div class="rechipt_box">
                                  <label><span style="color:#fd634f;margin-right: 4px;">*</span>问题答案：</label>
                                  <div class="iptbox">
                                      <input type="text" id="new_mibao_answer" class="rechipt" />
                                  </div>
                              </div>

							  <div class="rechipt_box">
									<label><span style="color:rgba(0,0,0,0.9);margin-right: 4px;">*</span>关联功能：</label>
									<div class="iptbox" style="line-height:38px;font-size:14px;">
										<input type="checkbox" id="findpwd_mibao" <if condition="$user['findpwd_mibao']==1">checked="checked"</if> /> 找回登录密码

										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

										<input type="checkbox" id="findpaypwd_mibao" <if condition="$user['findpaypwd_mibao']==1">checked="checked"</if> /> 找回交易密码
									</div>
							  </div>

							  <div class="rechipt_box" style="display:none;">
                                  <label>验证方式：</label>
                                  <div class="iptbox">
                                      <select id="chkstyle" class="rechipt" style="width:400px;">
                                  <option value="email">邮箱验证</option>
										<!-- <option value="">请选择验证方式</option> -->
									  </select>
                                  </div>
                              </div>

                              <div class="rechipt_box" id="mobile_div" style="display:none;">
                                  <label>短信验证码：</label>
                                  <div class="iptbox">
                                      <input type="text" id="mobile_verify" value="" class="rechipt halfipt" maxlength="6" />
                                      <input type="button" id="regBtn" onclick="SendCode()" value="点击获取手机验证码" class="yzmbut">
									  <if condition="$user['mobile'] eq '' || $user['mobile'] eq null">
										<p class="attention">您没有绑定手机，请先绑定手机或换成其它验证方式</p>
									  <else />
										<p class="attention">* 您接收短信的手机是{$user['mobile']}</p>
									  </if>
                                  </div>
                              </div>

							  <div class="rechipt_box" id="email_div" style="display:block;">
								  <label><span style="color:#fd634f;margin-right: 4px;">*</span>邮箱验证码：</label>
                                  <div class="iptbox">
                                      <input type="text" id="email_verify" value="" class="rechipt halfipt" maxlength="6" style="float: left;" />
                                      <input type="button" id="regBtn" onclick="EmCode()" value="点击获取邮箱验证码" class="yzmbut">
									  <if condition="$user['email'] eq '' || $user['email'] eq null">
										<p class="attention"><br/><br/>您没有绑定邮箱，请先绑定邮箱</p>
									  <else />
										<p class="attention"><br/><br/>接收验证码的邮箱{$user['email']}</p>
									  </if>
                                  </div>
							  </div>

                              <div class="rechipt_box">
                                  <div class="iptbox">
                                      <input type="button" class="rechbut" id="btn-submit" value="保存" title="保存" onclick="Update1()"/>
                                  </div>
                              </div>
                          </div>
                        <else />
						  <div class="rechmid">
                              <div class="rechipt_box">
                                  <label>密保问题：</label>
                                  <div class="iptbox">
                                      <select id="mibao_question" class="rechipt" style="width:358px;">
                                    <option value="">请选择密保问题</option>
                                    <option value="你父亲的姓名">你父亲的姓名</option>
                                    <option value="你母亲的姓名">你母亲的姓名</option>
                                    <option value="你爱人的姓名">你爱人的姓名</option>
                                    <option value="你的出生日期">你的出生日期</option>
                                    <option value="你父亲的出生日期">你父亲的出生日期</option>
                                    <option value="你母亲的出生日期">你母亲的出生日期</option>
                                    <option value="你爱人的出生日期">你爱人的出生日期</option>
                                </select>
                                  </div>
                              </div>

                              <div class="rechipt_box">
                                  <label>问题答案：</label>
                                  <div class="iptbox">
                                      <input type="text" id="mibao_answer" class="rechipt" />
                                  </div>
                              </div>

                              <div class="rechipt_box">
                                  <label>新密保问题：</label>
                                  <div class="iptbox">
                                      <select id="new_mibao_question" class="rechipt" style="width:358px;">
                                    <option value="">请选择密保问题</option>
                                    <option value="你父亲的姓名">你父亲的姓名</option>
                                    <option value="你母亲的姓名">你母亲的姓名</option>
                                    <option value="你爱人的姓名">你爱人的姓名</option>
                                    <option value="你的出生日期">你的出生日期</option>
                                    <option value="你父亲的出生日期">你父亲的出生日期</option>
                                    <option value="你母亲的出生日期">你母亲的出生日期</option>
                                    <option value="你爱人的出生日期">你爱人的出生日期</option>
                                </select>
                                  </div>
                              </div>

                              <div class="rechipt_box">
                                  <label>新问题答案：</label>
                                  <div class="iptbox">
                                      <input type="text" id="new_mibao_answer" class="rechipt" placeholder="不修改不要填" />
                                  </div>
                              </div>

							  <div class="rechipt_box">
									<label>关联功能：</label>
									<div class="iptbox" style="line-height:38px;font-size:14px;">
										<input type="checkbox" id="findpwd_mibao" <if condition="$user['findpwd_mibao']==1">checked="checked"</if> /> 找回登录密码

										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

										<input type="checkbox" id="findpaypwd_mibao" <if condition="$user['findpaypwd_mibao']==1">checked="checked"</if> /> 找回交易密码
									</div>
							  </div>

							  <div class="rechipt_box" style="display:none;">
                                  <label>验证方式：</label>
                                  <div class="iptbox">
                                      <select id="chkstyle" class="rechipt" style="width:358px;">
                                      <option value="email">邮箱验证</option>
										<!-- <option value="">请选择验证方式</option> -->
										<!--<option value="mobile">手机号码验证</option>-->
									  </select>
                                  </div>
                              </div>

                              <div class="rechipt_box" id="mobile_div" style="display:none;">
                                  <label>短信验证码：</label>
                                  <div class="iptbox">
                                      <input type="text" id="mobile_verify" value="" class="rechipt halfipt">
                                      <input type="button" id="regBtn" onclick="SendCode()" value="点击获取手机验证码" class="yzmbut">
                                      <p class="attention">* 接收短信的手机{$mobile}</p>
                                  </div>
                              </div>

							  <div class="rechipt_box" id="email_div" style="display:block;">
								  <label>邮箱验证码：</label>
                                  <div class="iptbox">
                                      <input type="text" id="email_verify" value="" class="rechipt halfipt" maxlength="6" />
                                      <input type="button" id="regBtn" onclick="EmCode()" value="点击获取邮箱验证码" class="yzmbut">
									  <if condition="$user['email'] eq '' || $user['email'] eq null">
										<p class="attention">您没有绑定邮箱，请先绑定邮箱</p>
									  <else />
										<p class="attention">* 接收验证码的邮箱{$user['email']}</p>
									  </if>
                                  </div>
							  </div>

                              <div class="rechipt_box">
                                  <div class="iptbox mrl110">
                                      <input type="button" class="rechbut" id="btn-submit" value="保存" title="保存" onclick="Update()"/>
                                  </div>
                              </div>
                          </div>
                        </if>
                      </li>
                  </ul>
              </div>
          </div>
      </div>
  </div>
</div>
</div>
<script type="text/javascript">
  $('input').focus(function(){
    var t=$(this);
    if(t.attr('type')=='text'||t.attr('type')=='password')
      t.css({'box-shadow' : '0px 0px 3px #1583fb','border' : '1px solid #1583fb','color' : '#333' });
    if(t.val()==t.attr('placeholder'))
      t.val('');
  });
  $('input').blur(function(){
    var t=$(this);
    if(t.attr('type')=='text'||t.attr('type')=='password')
      t.css({'box-shadow' : 'none','border' : '1px solid #e1e1e1','color' : '#333' });
    if(t.attr('type')!='password'&&!t.val())
      t.val(t.attr('placeholder'));
  });

function SendCode() {
  var chkstyle = $("#chkstyle").val();
  if(!chkstyle || chkstyle != 'mobile'){
	layer.tips('您选择的验证方式不是短信验证', '#chkstyle', {
        tips: 3
    });
    return false;
  }
  layer.load(0, {shade: [0.5,'#8F8F8F']});
    $('#regBtn').attr("disabled", "disabled");
    $.post("{:U('Verify/mibao')}", {}, function (data) {
    layer.closeAll();
      if (data.status == 1) {
        layer.msg(data.info, {
          icon: 1
        });
        var obj = $('#regBtn');
        var wait = 120;
        var interval = setInterval(function () {
          obj.css('backgroundColor', '#f6f6f6');
          obj.val(wait + '秒再次发送');
          wait--;
          if (wait < 0) {
            obj.removeAttr("disabled");
            clearInterval(interval);
            obj.val('获取验证码');
            obj.css('backgroundColor', '#f6f6f6');
          }
          ;
        }, 1000);
      } else {
        $('#regBtn').removeAttr("disabled");
        layer.msg(data.info, {
          icon: 2
        });
      }
    }, "json");
}

function EmCode() {
  var chkstyle = $("#chkstyle").val();
  if(!chkstyle || chkstyle != 'email'){
	layer.tips('您选择的验证方式不是邮箱验证', '#chkstyle', {
        tips: 3
    });
    return false;
  }
  layer.load(0, {shade: [0.5,'#8F8F8F']});
    $('#regBtn').attr("disabled", "disabled");
    $.post("{:U('Verify/mibaoemail')}", {}, function (data) {
    layer.closeAll();
      if (data.status == 1) {
        layer.msg(data.info, {
          icon: 1
        });
        var obj = $('#regBtn');
        var wait = 120;
        var interval = setInterval(function () {
          obj.css('backgroundColor', '#f6f6f6');
          obj.val(wait + '秒再次发送');
          wait--;
          if (wait < 0) {
            obj.removeAttr("disabled");
            clearInterval(interval);
            obj.val('获取验证码');
            obj.css('backgroundColor', '#f6f6f6');
          }
          ;
        }, 1000);
      } else {
        $('#regBtn').removeAttr("disabled");
        layer.msg(data.info, {
          icon: 2
        });
      }
    }, "json");
}

  function Update(){
    var mibao_question=$("#mibao_question").val();
    var mibao_answer=$("#mibao_answer").val();
    var new_mibao_question=$("#new_mibao_question").val();
    var new_mibao_answer=$("#new_mibao_answer").val();
	var chkstyle = $("#chkstyle").val();
	if($("#findpwd_mibao").attr("checked") == "checked"){
		var findpwd_mibao = 1;
	}else{
		var findpwd_mibao = 0;
	}
	if($("#findpaypwd_mibao").attr("checked") == "checked"){
		var findpaypwd_mibao = 1;
	}else{
		var findpaypwd_mibao = 0;
	}
	if(!chkstyle){
		layer.tips('您选择验证方式！', '#chkstyle', {
			tips: 3
		});
		return false;
	}
    var mobile_verify = $("#mobile_verify").val();
    if (chkstyle == 'mobile' && (mobile_verify == "" || mobile_verify == null)) {
      layer.tips('请输入短信验证码', '#mobile_verify', {
        tips: 3
      });
      return false;
    }
	var email_verify = $("#email_verify").val();
    if (chkstyle == 'email' && (email_verify == "" || email_verify == null)) {
      layer.tips('请输入邮箱验证码', '#email_verify', {
        tips: 3
      });
      return false;
    }
    if(mibao_question==""||mibao_question==null){
        layer.tips('请选择密保问题','#mibao_question',{tips:3});
        return false;
    }
    if(mibao_answer==""||mibao_answer==null){
        layer.tips('请输入密保问题答案','#mibao_answer',{tips:3});
        return false;
    }
    $.post("{:U('User/upmibao')}",{chkstyle:chkstyle, mobile_verify:mobile_verify, email_verify:email_verify,mibao_question : mibao_question,mibao_answer : mibao_answer,new_mibao_question : new_mibao_question,new_mibao_answer:new_mibao_answer,findpwd_mibao:findpwd_mibao,findpaypwd_mibao:findpaypwd_mibao },function(data){
      if(data.status==1){
        layer.msg(data.info,{icon : 1 });
        window.location="{:U('User/mibao')}";
      }else{
        layer.msg(data.info,{icon : 2 });
        if(data.url){
          window.location=data.url;
        }
      }
    },"json");
  }
  function Update1(){
    var mibao_question='';
    var mibao_answer='';
    var new_mibao_question=$("#new_mibao_question").val();
    var new_mibao_answer=$("#new_mibao_answer").val();
	var chkstyle = $("#chkstyle").val();
	if($("#findpwd_mibao").attr("checked")=="checked"){
		var findpwd_mibao = 1;
	}else{
		var findpwd_mibao = 0;
	}
	if($("#findpaypwd_mibao").attr("checked")=="checked"){
		var findpaypwd_mibao = 1;
	}else{
		var findpaypwd_mibao = 0;
	}
	if(!chkstyle){
		layer.tips('您选择验证方式！', '#chkstyle', {
			tips: 3
		});
		return false;
	}
    var mobile_verify = $("#mobile_verify").val();
    if (chkstyle == 'mobile' && (mobile_verify == "" || mobile_verify == null)) {
      layer.tips('请输入短信验证码', '#mobile_verify', {
        tips: 3
      });
      return false;
    }
	var email_verify = $("#email_verify").val();
    if (chkstyle == 'email' && (email_verify == "" || email_verify == null)) {
      layer.tips('请输入邮箱验证码', '#email_verify', {
        tips: 3
      });
      return false;
    }
    if(new_mibao_question==""||new_mibao_question==null){
        layer.tips('请选择密保问题','#mibao_question',{tips:3});
        return false;
    }
    if(new_mibao_answer==""||new_mibao_answer==null){
        layer.tips('请输入密保问题答案','#mibao_answer',{tips:3});
        return false;
    }

    $.post("{:U('User/upmibao')}",{chkstyle:chkstyle, mobile_verify:mobile_verify, email_verify:email_verify, mibao_question : mibao_question,mibao_answer : mibao_answer,new_mibao_question : new_mibao_question,new_mibao_answer:new_mibao_answer,findpwd_mibao:findpwd_mibao,findpaypwd_mibao:findpaypwd_mibao},function(data){
      if(data.status==1){
        layer.msg(data.info,{icon : 1 });
        window.location="{:U('User/mibao')}";
      }else{
        layer.msg(data.info,{icon : 2 });
        if(data.url){
          window.location=data.url;
        }
      }
    },"json");
  }
	$("#mibao_answer").focus(function(){
		var mibaoquestion = $("#mibao_question").val();
		if(!mibaoquestion){
			layer.tips('请选择密保问题！','#mibao_question',{tips:3});
		}
	});
	$("#mibao_answer").blur(function(){
		var mibaoanswer = $("#mibao_answer").val();
		if(!mibaoanswer){
			layer.tips('请填写密保答案！','#mibao_answer',{tips:3});
		}
	});
	$("#new_mibao_answer").focus(function(){
		var mibaoquestion = $("#new_mibao_question").val();
		if(!mibaoquestion){
			layer.tips('请选择密保问题！','#new_mibao_question',{tips:3});
		}
	});
	$("#new_mibao_answer").blur(function(){
		var mibaoanswer = $("#new_mibao_answer").val();
		if(!mibaoanswer){
			layer.tips('请填写密保答案！','#new_mibao_answer',{tips:3});
		}
	});
	$("#mobile_verify").blur(function(){
		var mobileverify = $("#mobile_verify").val();
		if(!mobileverify){
			layer.tips('请填写短信验证码！','#mobile_verify',{tips:3});
		}
	});
	$("#chkstyle").change(function(){
		if($(this).val()=="mobile"){
			$("#mobile_div").show();
			$("#email_div").hide();
		}else if($(this).val()=="email"){
			$("#mobile_div").hide();
			$("#email_div").show();
		}
	});
	$("#findpwd_mibao").click(function(){
		if($(this).attr("checked")=="checked"){
			$(this).attr("checked",false);
		}else{
			$(this).attr("checked","checked");
		}
	});
	$("#findpaypwd_mibao").click(function(){
		if($(this).attr("checked")=="checked"){
			$(this).attr("checked",false);
		}else{
			$(this).attr("checked","checked");
		}
	});
  //菜单高亮
  $('#user_mibao').addClass('on');
  $('#user_box').addClass('on');
</script>
<include file="Public:footer_new"/>
<include file="Public:header_new" />
<style type="text/css">
.emailtips{height:20px;line-height:20px;font-size:13px;text-indent:300px;}
</style>
<div class="outlogbox">
	<div class="logbox">
		<!-- <div class="regtop">
			<ul>
				<li class="selbut " id="mobile_reg">手机注册</li>
				<li class="selbut on" id="email_reg">邮箱注册</li>
			</ul>
		</div> -->
		<div class="inbox">
        <h1>注册账号</h1>
		<!--	<div class="boxrow" id="mobile_div"  style="display:none;">
				<label>手机号</label>
				<div class="rightbox">
					<input type="text" id="mobile" class="iptbox" placeholder="" onblur="regmobile()" />
				</div>
				<div id="mobile-msg" class="form_explain" data-explain="输入手机号<em></em>" style="display: none;">
					输入手机号<em></em>
				</div>
			</div>-->
			<div class="boxrow" id="enname_dv">
				<label><span class="xx_new">*</span>用户名</label>
				<div class="rightbox">
					<input type="text" id="en_name" class="iptbox" placeholder="" onblur="enname()" />
				</div>
				<div id="enname-msg" class="form_explain" data-explain="请输入英文用户名<em></em>" style="display: none;">
					请输入用户名<em></em>
				</div>
			</div>
			<!-- <div class="boxrow" id="email_div" style="display:none;">
				<label><span class="xx_new">*</span>邮箱</label>
				<div class="rightbox">
					<input type="text" id="email" class="iptbox" placeholder="" onblur="regemail()" />
				</div>
				<div id="email-msg" class="form_explain" data-explain="输入邮箱<em></em>" style="display: none;">
					输入邮箱<em></em>
				</div>
			</div> -->
				<div class="boxrow" id="mobile_div"  >
				<label>手机号</label>
				<div class="rightbox">
					<input type="text" id="mobile" class="iptbox" placeholder="" onblur="regmobile()" />
				</div>
				<div id="mobile-msg" class="form_explain" data-explain="输入手机号<em></em>" style="display: none;">
					输入手机号<em></em>
				</div>
			</div>
			<div class="boxrow" id="reg_first_verify" >
				<label><span class="xx_new">*</span>验证码</label>
				<div class="rightbox">
					<input type="text" id="verify" class="iptbox" value="" placeholder="" onblur="regverify()" style="width: 190px; box-shadow: none;" maxlength="4"/>
					<span class="yzmimg">
						<img class="codeImg reloadverify" src="{:U('Verify/code')}" title="换一张" onclick="this.src=this.src+'?t='+Math.random()">
					</span>
				</div>
				<div id="verify-msg" class="form_explain" data-explain="输入验证码<em></em>" style="display: none;">
					输入验证码<em></em>
				</div>
			</div>
			<div class="boxrow" id="myz_div"  >
				<label>短信验证码</label>
				<div class="rightbox">
					<input type="text" id="mobilecode" class="iptbox" value="" onblur="inputcode()" style="width: 165px;" placeholder="" maxlength="6"/>
					<input id="regBtn" type="button" class="getyzm" value="发送验证码" onclick="SendCode()" style="float: right;">
				</div>
				<div id="mobile-msg" class="form_explain" data-explain="请输入收到的手机验证码<em></em>" style="display: none;">
					请输入收到的手机验证码<em></em>
				</div>
			</div>
			<!-- <div class="boxrow" id="eyz_div" style="display:none;">
				<label><span class="xx_new">*</span>邮箱验证码</label>
				<div class="rightbox">
					<input type="text" id="emailcode" class="iptbox" value="" onblur="emailcode()" style="width: 190px;" placeholder="" maxlength="6"/>
					<input id="regBtn" type="button" class="getyzm" value="发送验证码" onclick="EmCode()" style="float: right;">
				</div>
				<div id="emailcode-msg" class="form_explain" data-explain="请输入收到的邮箱验证码<em></em>" style="display: none;">
					请输入收到的邮箱验证码<em></em>
				</div>
			</div> -->
			<div class="emailtips" style="display:none;"><a style="color:red;" href="/Article/detail/id/74.html">收不到邮件怎么办？</a></div>
			<div class="boxrow">
				<label><span class="xx_new">*</span>登录密码</label>
				<div class="rightbox">
					<input type="password" id="password" class="iptbox" value="" onblur="regpassword()" onkeyup="chkpwd();" maxlength="16"/>
				</div>
				<div id="password-msg" class="form_explain" data-explain="密码格式为6~16位，不含特殊符号！<em></em>" style="display: none;">
					密码格式为6~16位，不含特殊符号！<em></em>
				</div>
			</div>
			<div class="boxrow">
				<label><span class="xx_new">*</span>确认密码</label>
				<div class="rightbox">
					<input type="password" id="repassword" class="iptbox" value="" onblur="regrepassword()" onkeyup="chkrepwd();" maxlength="16"/>
				</div>
				<div id="repassword-msg" class="form_explain" data-explain="两次输入的密码不一致<em></em>" style="display: none;">
					两次输入的密码不一致<em></em>
				</div>
			</div>
			<div class="boxrow">
				<label>邀请码</label>
				<div class="rightbox">
					<input id="invit" name="invite" type="text" class="iptbox" placeholder="非必填" value="{$Think.session.invit}" <notempty name="Think.session.invit">readonly</notempty> />
				</div>
			</div>
			<input type="hidden" id="reg_type" value="phone" />
			<div class="boxrow">
				<div class="rightbox nolabel">
					<input type="button" class="iptbut" name="index_submit" id="loginSubmin" onclick="Update();" value="立即注册" title="立即注册" >
					<p class="linkbox textleft">注册即视为同意 <a href="/Article/detail/id/10.html" style="color:#108ee9;" target="_blank">《用户注册协议》</a></p>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$('input').focus(function(){
		var t=$(this);
		if(t.attr('type')=='text'||t.attr('type')=='password')
			t.css({'box-shadow':'0px 0px 3px #1583fb','border':'1px solid #1583fb','color':'#333' });
		if(t.val()==t.attr('placeholder'))
			t.val('');
	});
	$('input').blur(function(){
		var t=$(this);
		if(t.attr('type')=='text'||t.attr('type')=='password')
			t.css({'box-shadow':'none','border':'1px solid #e1e1e1','color':'#333' });
		if(t.attr('type')!='password'&&!t.val())
			t.val(t.attr('placeholder'));
	});
	function regmobile(){
		var mobile = $('#mobile').val();
		if(mobile==""||mobile==null||(mobile!=null&&mobile.length<11)){
			layer.tips('请输入手机号','#mobile',{tips:3});
			return false;
		}
		$.post("{:U('Login/chkmobile')}",{mobile:mobile},function(data){
			if(!data.status){
				layer.tips(data.info,'#mobile',{tips:3});
			}
		},'json');
	}
	function inputcode(){
		var mobilecode = $("#mobilecode").val();
		if(mobilecode==""||mobilecode==null){
			layer.tips('请输入短信验证码!','#mobilecode',{tips:3});
			return false;
		}
	}
	function regemail(){
		var email = $('#email').val();
		if(email==""||email==null){
			layer.tips('请输入电子邮箱','#email',{tips:3});
			return false;
		}
		$.post("{:U('Login/chkemail')}",{email:email},function(data){
			if(!data.status){
				layer.tips(data.info,'#email',{tips:3});
			}
		},'json');
	}

    function enname(){
        var email = $('#en_name').val();
        if(email==""||email==null){
            layer.tips('请输入英文用户名','#en_name',{tips:3});
            return false;
        }

        var Regx = /^[a-zA-Z]\w{3,15}$/;
        if(!(Regx.test(email))){
            layer.tips('请输入4-16位英文用户名','#en_name',{tips:3});
		}
    }

	function EmCode(){
        var en_name = $("#en_name").val();
        if (en_name == "" || en_name == null) {
            layer.tips('请输入英文用户名', '#en_name', {tips: 3});
            return false;
        }
		var email = $("#email").val();
        if (email == "" || email == null) {
            layer.tips('请输入电子邮箱', '#email', {tips: 3});
            return false;
        }
		var verify = $('#verify').val();
		if(verify==""||verify==null){
			layer.tips('请先输入图形验证码', '#verify', {tips: 3});
			return false;
		}
		// layer.load(0, {shade: [0.5,'#8F8F8F']});
		
		$('#regBtn').attr("disabled", "disabled");
        var obj = $('#regBtn');
        var wait = 60;
        var interval = setInterval(function () {
            obj.css('backgroundColor', '#f6f6f6');
            obj.val(wait + '秒再次发送');
            wait--;
            if (wait < 0) {
            	$('#regBtn').removeAttr("disabled");
                clearInterval(interval);
                obj.val('获取验证码');
                obj.css('backgroundColor', '#f6f6f6');
            }
            ;
        }, 1000);
        $.post("{:U('Verify/regssemail')}", {
            email: email,verify: verify
        }, function (data) {
			// layer.closeAll();
            if (data.status == 1) {
                //刷新验证码
               layer.msg(data.info, {icon: 1});
                
            } else {
                //刷新验证码
                layer.msg(data.info, {icon: 2});
                clearInterval(interval);
                obj.val('获取验证码');
                obj.css('backgroundColor', '#f6f6f6');
                $('#regBtn').removeAttr("disabled");
                if (data.url) {
                    window.location = data.url;
                }
            }
        }, "json");
	}
	function SendCode() {
        var mobile = $("#mobile").val();
        if (mobile == "" || mobile == null) {
            layer.tips('请输入手机号', '#mobile', {tips: 3});
            return false;
        }
		var verify = $('#verify').val();
		if(verify==""||verify==null){
			layer.tips('请输入图形验证码', '#verify', {tips: 3});
			return false;
		}
		layer.load(0, {shade: [0.5,'#8F8F8F']});
        $.post("{:U('Verify/regss')}", {
            mobile: mobile,verify: verify
        }, function (data) {
			layer.closeAll();
            if (data.status == 1) {
                //刷新验证码
                $('#regBtn').attr("disabled", "disabled");
                layer.msg(data.info, {icon: 1});
                var obj = $('#regBtn');
                var wait = 60;
                var interval = setInterval(function () {
                    obj.css('backgroundColor', '#f6f6f6');
                    obj.val(wait + '秒再次发送');
                    wait--;
                    if (wait < 0) {
                    	$('#regBtn').removeAttr("disabled");
                        clearInterval(interval);
                        obj.val('获取验证码');
                        obj.css('backgroundColor', '#f6f6f6');
                    };
                }, 1000);
            } else {
                //刷新验证码
                layer.msg(data.info);
                $('#regBtn').removeAttr("disabled");
				$(".codeImg").click();
                if (data.url) {
                    window.location = data.url;
                }
            }
        }, "json");
    }
	function regverify(){
		var verify = $('#verify').val();
		if(verify==""||verify==null){
			layer.tips('请输入图形验证码','#verify',{tips:3});
			return false;
		}
	}

	function regpassword(){
		var password = $('#password').val();
		if(password==""||password==null){
			layer.tips('请输入登录密码','#password',{tips:3});
			return false;
		}
	}

	function regrepassword(){
		var password = $('#password').val();
		var repassword = $('#repassword').val();
		if(repassword==""||repassword==null){
			layer.tips('请输入确认密码','#repassword',{tips:3});
			return false;
		}else{
			if(password!=repassword){
				layer.tips('两次输入的密码不一致','#repassword',{tips:3});
				return false;
			}
		}
	}
	function Update(){
		var reg_type = $("#reg_type").val();
		if(reg_type != 'phone'){
			layer.msg('参数错误！',{icon:2});
		}
		var mobile=$("#mobile").val();
		// var email = $("#email").val();
		var en_name = $("#en_name").val();
		var password=$("#password").val();
		var repassword=$("#repassword").val();
		var verify=$("#verify").val();
        var mobilecode = $("#mobilecode").val();
		var invit=$("#invit").val();

        if ((mobile == "" || mobile == null) && reg_type == 'phone') {
            layer.tips('请输入手机号', '#mobile', {tips: 3});
            return false;
        }
        if ((en_name == "" || en_name == null) && reg_type == 'phone') {
            layer.tips('请输入英文用户名', '#en_name', {tips: 3});
            return false;
        }
		if(password==""||password==null){
			layer.tips('请输入登录密码','#password',{tips:3});
			return false;
		}
		if(repassword==""||repassword==null){
			layer.tips('请输入确认密码','#repassword',{tips:3});
			return false;
		}
		if(password!=repassword){
			layer.tips('两次输入的密码不一致','#repassword',{tips:3});
			return false;
		}

		if((mobilecode==""||mobilecode==null) && reg_type == 'phone'){
			layer.tips('请输入短信验证码','#mobilecode',{tips:3});
			return false;
		}
		if(verify==""||verify==null){
			layer.tips('请输入图形验证码','#verify',{tips:3});
			return false;
		}
		$.post("{:U('Login/upregister')}",{reg_type:reg_type,mobile:mobile,password:password,repassword:repassword,verify:verify,mobilecode:mobilecode,en_name:en_name,invit:invit},function(data){
			if(data.status==1){
				layer.msg(data.info,{icon:1});
				if(reg_type == 'email_a'){
                    $.cookies.set('cookie_username',email);
				}
				window.location.href=window.location.href;
			}else{
				layer.msg(data.info,{icon:2});
				if(data.url){
					window.location.href=data.url;
				}
			}
		},"json");
	}


	function chkpwd(){
		var password = $("#password").val();
		var patten =/^[a-zA-Z0-9]+$/;
		var match = new RegExp(patten);
		if (!match.test(password)) {
			layer.tips('密码格式为6~16位，不含特殊符号！','#password',{tips:3});
			var result = password.substring(0,password.length-1);
			$("#password").val(result);
		}
	}
	function chkrepwd(){
		var repassword = $("#repassword").val();
		var paypassword = $("#paypassword").val();
		var patten =/^[a-zA-Z0-9]+$/;
		var match = new RegExp(patten);
		if (!match.test(repassword)) {
			layer.tips('密码格式为6~16位，不含特殊符号！','#repassword',{tips:3});
			var result = repassword.substring(0,repassword.length-1);
			$("#repassword").val(result);
		}
	}

	function emailcode(){
		var emailcode = $("#emailcode").val();
		if(emailcode==""||emailcode==null){
			layer.tips('请输入邮箱验证码！','#emailcode',{tips:3});
			return false;
		}
	}


//顶部注册高亮显示
$('.zc_index').addClass('current_new2');
</script>
<include file="Public:footer_new" />